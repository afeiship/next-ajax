/*!
 * name: next-ajax
 * url: https://github.com/afeiship/next-ajax
 * version: 1.0.0
 * date: 2019-09-01T03:57:27.176Z
 * license: MIT
 */
!function(){var t=t||this||window||Function("return this")(),e=t.nx||require("next-js-core2"),s=e.Xhr||require("next-xhr"),n=(e.json||require("next-json"),e.param||require("next-param")),o=e.contentType||require("next-content-type"),i=e.capitalize||require("next-capitalize"),r=(e.DataTransform||require("next-data-transform"),{async:!0,timeout:3e3,contentType:"json",headers:{},onRequest:e.noop,onResponse:e.noop,onSuccess:e.noop,onFail:e.noop,onComplete:e.noop,onTimeout:e.noop}),a=e.declare("nx.Ajax",{properties:{$success:{get:function(){var t=this.xhr;try{return!t.status&&"file:"==location.protocol||t.status>=200&&t.status<300||304==t.status||navigator.userAgent.indexOf("Safari")>-1&&void 0===t.status}catch(t){}return!1}},$url:{get:function(){var t=this.method,e=this.url;return"GET"===t?e+(e.indexOf("?")>-1?"&":"?")+n(this.data):e}},$data:function(){return"GET"===this.method?this.data:null}},methods:{init:function(t,n,o,i){this.method=(t||"GET").toUpperCase(),this.data=o,this.url=n,this.options=e.mix(null,r,i),this.xhr=s.create(),this.request()},intercept:function(t){var e="on"+i(t);this.options[e]({xhr:this.xhr,method:this.method,url:this.$url,xhr:this.$data,options:this.options})},onStateChange:function(){var t=this.options;this.$success?(this.intercept("response"),t.onSuccess(this.result("success"))):t.onFail(this.result("fail")),t.onComplete(this.result("complete"))},onResult:function(t,s){var n=this.xhr;return{status:t||"unknown",code:s.code,data:e.parse(n.responseText),xhr:n}},result:function(t){var e={code:-1};switch(t){case"success":e={code:0};break;case"fail":e={code:1};break;case"timeout":e={code:2};break;case"complete":e={code:3};break;default:e={code:-1}}return this.onResult(t,e)},setContentType:function(){var t=this.options.contentType;this.xhr.setRequestHeader("Content-Type",o(t))},setHeaders:function(){var t=this.options.headers;e.forIn(t,function(t,e){this.xhr.setRequestHeader(t,e)},this)},request:function(){var e=!1,s=!1,n=this.options,o=this.xhr,i=this;o.onreadystatechange=function(){4==o.readyState&&(e||i.onStateChange(),s=!0)},o.open(this.method,this.$url,this.options.async),this.intercept("request"),this.setContentType(),this.setHeaders(),o.send(this.$data),this._timer&&clearTimeout(this._timer),this._timer=t.setTimeout(function(){s||(e=!0,n.onTimeout(i.result("timeout")),n.onComplete(i.result("complete")))},n.timeout)}}});"undefined"!=typeof module&&module.exports&&(module.exports=a)}();