/*!
 * name: next-ajax
 * url: https://github.com/afeiship/next-ajax
 * version: 1.0.0
 * date: 2019-08-31T15:47:40.305Z
 * license: MIT
 */
!function(){var t=t||this||window||Function("return this")(),e=t.nx||require("next-js-core2"),s=e.Xhr||require("next-xhr"),o=(e.json||require("next-json"),e.param||require("next-param")),n=e.contentType||require("next-content-type"),i=e.capitalize||require("next-capitalize"),r=(e.DataTransform||require("next-data-transform"),{async:!0,timeout:3e3,contentType:"json",headers:{},onRequest:e.noop,onResponse:e.noop,onSuccess:e.noop,onError:e.noop,onComplete:e.noop,onTimeout:e.noop}),a=e.declare("nx.Ajax",{properties:{success:{get:function(){var t=this.xhr;try{return!t.status&&"file:"==location.protocol||t.status>=200&&t.status<300||304==t.status||navigator.userAgent.indexOf("Safari")>-1&&void 0===t.status}catch(t){}return!1}},url:{get:function(){var t=this.method,e=this.url;return"GET"===t?e+(e.indexOf("?")>-1?"&":"?")+o(this.data):e}},data:function(){return"GET"===this.method?this.data:null}},methods:{init:function(t,o,n,i){this.method=(t||"GET").toUpperCase(),this.url=o,this.data=n,this.options=e.mix(null,r,i),this.xhr=s.create()},onIntercept:function(t){var e="on"+i(t);inOptions[e]({xhr:this.xhr,method:this.method,url:this.url,xhr:this.data,options:this.options})},onStateChange:function(){var t=this.options;this.success?(this.onIntercept("response"),t.onSuccess(this.result("success"))):t.onFail(this.result("fail")),t.onComplete(this.result("complete"))},onResult:function(t,e){return{status:t,code:e.code,xhr:this.xhr}},result:function(t){var e={code:-1};switch(t){case"success":e={code:0};break;case"fail":e={code:1};break;case"timeout":e={code:2};break;case"complete":e={code:3};break;default:e={code:-1}}return this.onResult(t,e)},setContentType:function(){var t=this.options.contentType;this.xhr.setRequestHeader("Content-Type",n(t))},setHeaders:function(){var t=this.options.headers;e.forIn(t,function(t,e){this.xhr.setRequestHeader(t,e)},this)},request:function(){var e=!1,s=!1,o=this.options,n=this.xhr,i=this;n.onreadystatechange=function(){4==n.readyState&&(e||i.onStateChange(),s=!0)},n.open(this.method,this.url,this.options.async),this.onIntercept("request"),this.setContentType(),this.setHeaders(),n.send(this.data),this._timer&&clearTimeout(this._timer),this._timer=t.setTimeout(function(){s||(e=!0,o.onTimeout(i.result("timeout")),o.onComplete(i.result("complete")))},o.timeout)}}});"undefined"!=typeof module&&module.exports&&(module.exports=a)}();