/*!
 * name: next-ajax
 * url: https://github.com/afeiship/next-ajax
 * version: 1.0.0
 * date: 2019-08-31T15:51:15.522Z
 * license: MIT
 */
!function(){var t=t||this||window||Function("return this")(),e=t.nx||require("next-js-core2"),n=e.Xhr||require("next-xhr"),s=(e.json||require("next-json"),e.param||require("next-param")),o=e.contentType||require("next-content-type"),i=e.capitalize||require("next-capitalize"),r=e.DataTransform||require("next-data-transform"),a={async:!0,timeout:3e3,contentType:"json",headers:{},onRequest:e.noop,onResponse:e.noop,onSuccess:e.noop,onError:e.noop,onComplete:e.noop,onTimeout:e.noop},u=e.declare("nx.Ajax",{properties:{success:{get:function(){var t=this.xhr;try{return!t.status&&"file:"==location.protocol||t.status>=200&&t.status<300||304==t.status||navigator.userAgent.indexOf("Safari")>-1&&void 0===t.status}catch(t){}return!1}},url:{get:function(){var t=this.method,e=this.url;return"GET"===t?e+(e.indexOf("?")>-1?"&":"?")+s(this.data):e}},data:function(){return"GET"===this.method?this.data:null}},methods:{init:function(t,s,o,i){this.method=(t||"GET").toUpperCase(),this.url=s,this.data=o,this.options=e.mix(null,a,i),this.xhr=n.create()},onIntercept:function(t){var e="on"+i(t);inOptions[e]({xhr:this.xhr,method:this.method,url:this.url,xhr:this.data,options:this.options})},onStateChange:function(){var t=this.options;this.success?(this.onIntercept("response"),t.onSuccess(this.result("success"))):t.onFail(this.result("fail")),t.onComplete(this.result("complete"))},onResult:function(t,e){var n=this.options.contentType,s=this.xhr;return{status:t||"unknown",code:e.code,data:r[n](s.responseText),xhr:s}},result:function(t){var e={code:-1};switch(t){case"success":e={code:0};break;case"fail":e={code:1};break;case"timeout":e={code:2};break;case"complete":e={code:3};break;default:e={code:-1}}return this.onResult(t,e)},setContentType:function(){var t=this.options.contentType;this.xhr.setRequestHeader("Content-Type",o(t))},setHeaders:function(){var t=this.options.headers;e.forIn(t,function(t,e){this.xhr.setRequestHeader(t,e)},this)},request:function(){var e=!1,n=!1,s=this.options,o=this.xhr,i=this;o.onreadystatechange=function(){4==o.readyState&&(e||i.onStateChange(),n=!0)},o.open(this.method,this.url,this.options.async),this.onIntercept("request"),this.setContentType(),this.setHeaders(),o.send(this.data),this._timer&&clearTimeout(this._timer),this._timer=t.setTimeout(function(){n||(e=!0,s.onTimeout(i.result("timeout")),s.onComplete(i.result("complete")))},s.timeout)}}});"undefined"!=typeof module&&module.exports&&(module.exports=u)}();